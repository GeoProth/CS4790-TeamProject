@model CS4790TeamProject.Models.PurchaseOrder
@{
    ViewData["Title"] = "Add Items";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<body>
    <h1 style="text-align:center">Add Order Items</h1>
    <table id="tblOrderItems" class="table" cellpadding="0" cellspacing="0">
        <thead>
            <tr>
                <th style="width:150px">Item ID</th>
                <th style="width:150px">Price</th>
                <th style="width:150px">Qty</th>
                <th style="width:150px"><i class="fa fa-trash-o"></i></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @if (!@Model.OrderItems?.Any() ?? true)
            {
                <tr><td>EMPTY</td></tr>
            }
            else
            {
                @foreach (OrderItem item in @Model.OrderItems)
                {
                    <tr>
                        <td>@item.ItemID</td>
                        <td>@item.Price</td>
                        <td>@item.QuantityOrdered</td>
                        <td><input type="button" onclick="Remove(this)" /><i class="fa fa-trash-o"></i></td>
                    </tr>
                }
            }
        </tbody>
        <tfoot>
            <tr>
                <td><select id="txtID" asp-items="@ViewBag.Items"></select></td>
                <td><input type="text" id="txtPrice" /></td>
                <td><input type="text" id="txtQty" /></td>
                <td><input type="button" id="btnAdd" value="Add" /></td>
                <td></td>
            </tr>
        </tfoot>
    </table>
    <br />
    <input type="button" id="btnSave" value="Save All" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
    <script type="text/javascript">
        $("body").on("click", "#btnAdd", function () {
            //Reference the Name and Country TextBoxes.
            var txtID = $("#txtID");
            //var itemID = $("#txtID");
            var txtPrice = $("#txtPrice");
            var txtQty = $("#txtQty");

            //Get the reference of the Table's TBODY element.
            var tBody = $("#tblItems > TBODY")[0];
            //Add Row.
            var row = tBody.insertRow(-1);

            //Add ID cell.
            var cell = $(row.insertCell(-1));
            cell.html(txtID.val());

            //Add Price cell.
            cell = $(row.insertCell(-1));
            cell.html(txtPrice.val());

            //Add Qty cell.
            cell = $(row.insertCell(-1));
            cell.html(txtQty.val());

            //Add Button cell.
            cell = $(row.insertCell(-1));
            var btnRemove = $("<input />");
            btnRemove.attr("type", "button");
            btnRemove.attr("onclick", "Remove(this);");
            btnRemove.append("<i class='fa fa-trash-o'></i>");
            cell.append(btnRemove);

            //Clear the TextBoxes.
            txtIDval("");
            txtPrice.val("");
            txtQty.val("");

        });


        function Remove(button) {
            //Determine the reference of the Row using the Button.
            var row = $(button).closest("TR");
            var name = $("TD", row).eq(0).html();
            if (confirm("Do you want to delete: " + name)) {
                //Get the reference of the Table.
                var table = $("#tblItems")[0];

                //Delete the Table row using it's Index.
                table.deleteRow(row[0].rowIndex);
            }
        };

        $("body").on("click", "#btnSave", function () {
            //Loop through the Table rows and build a JSON array.
            var items = new Array();
            $("#tblItems TBODY TR").each(function () {
                var row = $(this);
                var item = {};
                item.ID = row.find("TD").eq(0).html();
                item.Price = row.find("TD").eq(1).html();
                item.Qty = row.find("TD").eq(1).html();
                items.push(item);

            });

            //Send the JSON array to Controller using AJAX.
            $.ajax({
                type: "POST",
                url: "/PurchaseOrders/InsertOrderItems",
                data: JSON.stringify(items),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (r) {
                    alert(r + " record(s) inserted.");
                }
            });

        });

    </script>

</body>
@*
    <div class="row border p-3 mb-3">
        <div class="col-4">
            <div class="form-inline mb-3">
                <label asp-for="TempOrderItem.Item" class="control-label mr-3">Part:</label>
                <div class="input-group">
                    <select name="ItemID" asp-for="TempOrderItem.Item.ItemId" class="form-control" asp-items="@ViewBag.ItemID"></select>
                    <div class="text-right ml-3">
                        <span class="input-group-append">
                            <a class="btn btn-sm" data-toggle="modal" data-target="#createPartModal">
                                <i class="fa fa-plus-circle" style="font-size:36px;color:#337AB7;margin-top:-10px;"></i>
                            </a>
                        </span>
                    </div>
                </div>
            </div>
            <div class="form-inline mb-3 fa-pull-right">
                <label asp-for="TempOrderItem.Item.MeasureID" class="mr-3">Unit of Measurement:</label>
                <select name="MeasureID" asp-for="TempOrderItem.Item.MeasureID" class="form-control" asp-items="@ViewBag.MeasureID"></select>
            </div>
            <div class="form-inline pl-1 mb-3 fa-pull-right">
                <label asp-for="TempOrderItem.QuantityOrdered" class="control-label mr-3">Quantity:</label>
                <input name="QuantityOrdered" asp-for="TempOrderItem.QuantityOrdered" min="0" type="number" class="form-control col-4" />
                <span asp-validation-for="TempOrderItem.QuantityOrdered" class="text-danger"></span>
            </div>
            <div class="form-inline mb-3 fa-pull-right">
                <label asp-for="TempOrderItem.Price" class="control-label mr-3">Price:</label>
                <div class="form-inline">
                    $<input name="Price" asp-for="TempOrderItem.Price" class="form-control ml-1 col-4" />
                </div>
                <span asp-validation-for="TempOrderItem.Price" class="text-danger"></span>
            </div>
            <div class="form-group text-center">
                <input name="button" type="submit" value="Add Part" class="btn btn-primary fa-pull-right" asp-action="CreateAddItems" />
            </div>
        </div>
        <div class="col-1"></div>
        <div class="col-7 card" style="background-color:dimgrey">
            <table class="table" id="tblItems" style="background-color:dimgrey;color:black;">
                <thead style="background-color:dimgrey;color:black;">
                    <tr class="row">
                        <th class="col-7 pl-4"><h5>Item</h5></th>
                        <th class="col-4"><h5>Quantity</h5></th>
                        <th class="col-1"><h4><i class="fa fa-trash-o"></i></h4></th>
                    </tr>
                </thead>
                <tbody style="background-color:dimgrey;color:black;">

                    @if (@Model.OrderItems.Count() > 0)
                    {
                        @foreach (var item in @Model.OrderItems)
                        {
                            <tr class="row">
                                <td class="col-7">@item.Item.ItemName</td>
                                <td class="col-4">@item.QuantityOrdered</td>
                                <td class="col-1"><button type="submit" asp-page-handler="removeitem" asp-route-index="@item.ItemID"><i class="fa fa-trash-o"></i></button></td>
                            </tr>
                        }

                    }
                    else
                    {
                        <tr class="row"><td class="col-12 text-center">EMPTY</td></tr>
                    }

                </tbody>
            </table>
        </div>
    </div>
*@